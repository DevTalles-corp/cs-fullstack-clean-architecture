@page "/note-editor"
@page "/note-editor/{NoteId:int}"
@inject ISender Sender

@if (isEditMode && Note is not null)
{
    <PageTitle>Editar nota</PageTitle>
    <p>Editando nota con el título: @Note.Title</p>
    <h3>Editar nota</h3>
    <a href="/notes" class="btn btn-secondary mb-2">Volver a notas</a>
}
else
{
    <PageTitle>Crear nota</PageTitle>
    <h3>Crear nota</h3>
}
@if (Note is not null)
{
    <EditForm Model="Note" OnSubmit="HandleSubmit" FormName="NoteEditorForm">
        <InputText @bind-Value="Note.Title" placeholder="Título" class="form-control mb-2" />
        <InputTextArea @bind-Value="Note.Content" placeholder="Contenido" class="form-control mb-2" rows="5" />
        <label>Fecha de publicación:</label>
        <InputDate @bind-Value="Note.PublishedAt" class="form-control mb-2" />
        <label class="form-check-label mb-2">Publicado:</label>
        <InputCheckbox @bind-Value="Note.IsPublished" class="form-check-input mb-2" />
        <button type="submit" class="btn btn-primary mt-3 w-100">Crear</button>
    </EditForm>
}


@code {
    private bool isEditMode => NoteId != null;
    [SupplyParameterFromForm]
    private NoteModel? Note { get; set; } = new NoteModel();
    [Parameter]
    public int? NoteId { get; set; }
    private async Task HandleSubmit()
    {
        var command = Note.Adapt<CreateNoteCommand>();
        var result = await Sender.Send(command);
        Note = result.Adapt<NoteModel>();
        Console.WriteLine("Nota creada satistactoriamente");
    }
}
